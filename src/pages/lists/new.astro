---
/**
 * List Creator Page - Dual mode (AI/Manual)
 *
 * Features:
 * - Mode switcher (AI vs Manual)
 * - AI generation form
 * - Manual paste form
 * - Draft preview
 * - Save list functionality
 */
import MainLayout from "../../layouts/MainLayout.astro";
// import { QuotaIndicator } from "../../components/QuotaIndicator"; // Disabled for MVP
import { UserMenu } from "../../components/UserMenu";

// Check authentication
const user = Astro.locals.user;

if (!user) {
  return Astro.redirect("/", 302);
}

// Fetch user email for display
const {
  data: { session },
} = await Astro.locals.supabase.auth.getSession();

const userEmail = session?.user?.email || user.email;

// TODO: Fetch AI quota status
const quotaRemaining = 5; // Placeholder
---

<MainLayout title="Nowa lista - Memo">
  <!-- User Menu Slot -->
  <UserMenu slot="user-menu" userEmail={userEmail} client:load />

  <!-- AI Quota Indicator Slot -->
  <!-- <QuotaIndicator slot="quota-indicator" client:load /> -->
  <!-- Disabled for MVP -->

  <!-- Main Content -->
  <div class="mx-auto max-w-4xl space-y-6">
    <!-- Header -->
    <div>
      <h1 class="text-3xl font-bold tracking-tight">Stwórz nową listę</h1>
      <p class="text-muted-foreground">Wybierz sposób tworzenia listy słówek</p>
    </div>

    <!-- Creator Container -->
    <div id="list-creator-container">
      <!-- Mode switcher and forms will be rendered here by React component -->
    </div>

    <!-- TODO: Draft Preview Component -->
  </div>
</MainLayout>

<script>
  import { createRoot } from "react-dom/client";
  import { createElement } from "react";
  import { ListCreator } from "../../components/ListCreator";

  const container = document.getElementById("list-creator-container");
  if (container) {
    const root = createRoot(container);
    root.render(createElement(ListCreator, { quotaRemaining: 5 }));
  }
</script>
